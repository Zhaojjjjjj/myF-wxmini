<view class="container">


  <!-- é¡¶éƒ¨æŒ‰é’® -->
  <view class="header">
    <button class="refresh-btn" bindtap="refreshRoom">
      <text class="btn-text">åˆ·æ–°</text>
    </button>
    <button class="invite-btn" bindtap="showInviteModal">
      <text class="btn-text">é‚€è¯·</text>
    </button>
    <button class="exit-btn" bindtap="exitRoom">
      <text class="btn-text">é€€å‡º</text>
    </button>
  </view>

  <!-- æˆå‘˜åˆ—è¡¨ -->
  <view class="members-container">
    <view class="members-scroll">
      <view wx:for="{{members}}" wx:key="id" class="member-card" bindtap="onMemberTap" data-user-id="{{item.id}}" data-user-nickname="{{item.nickname}}" data-user-avatar="{{item.avatar_url}}">
        <image class="avatar" src="{{item.avatar_url}}" mode="aspectFill"></image>
        <text class="nickname">{{item.nickname}}</text>
        <text class="score">{{item.score}}</text>
      </view>
    </view>
  </view>

  <!-- æ—¥å¿—åŒºåŸŸ -->
  <view class="logs">
    <block wx:for="{{logs}}" wx:key="id">
      <view class="log-item">
        <text class="log-text">{{item.created_at}} {{item.from_user_nickname}}è½¬è´¦{{item.to_user_nickname}} {{item.amount}}</text>
      </view>
    </block>
  </view>

  <!-- é‚€è¯·å¼¹çª— -->
  <view class="modal" wx:if="{{showInviteModal}}">
    <view class="modal-content invite-modal">
      <view class="modal-title">é‚€è¯·å¥½å‹åŠ å…¥æˆ¿é—´</view>
      <view class="qrcode-container">
        <image class="qrcode" src="{{qrcodeUrl}}" mode="aspectFit" wx:if="{{qrcodeUrl}}" binderror="onQrcodeError" bindload="onQrcodeLoad"></image>
        <view class="qrcode-loading" wx:if="{{!qrcodeUrl || qrcodeLoading}}">
          <text class="loading-text">å°ç¨‹åºç åŠ è½½ä¸­...</text>
        </view>
        <view class="qrcode-error" wx:if="{{qrcodeError}}">
          <text class="error-text">å°ç¨‹åºç åŠ è½½å¤±è´¥</text>
          <button class="retry-btn" bindtap="retryLoadQrcode">é‡è¯•</button>
        </view>
      </view>
      <view class="invite-tip">é•¿æŒ‰å°ç¨‹åºç ä¿å­˜åˆ°ç›¸å†Œï¼Œæˆ–ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®åˆ†äº«</view>
      <button class="share-btn" open-type="share">
        <text class="btn-icon">ğŸ“¤</text>
        <text class="btn-text">åˆ†äº«é‚€è¯·</text>
      </button>
      <button class="close-btn" bindtap="hideInviteModal">
        <text class="btn-icon">âŒ</text>
        <text class="btn-text">å…³é—­</text>
      </button>
    </view>
  </view>

  <!-- è½¬åˆ†å¼¹çª— -->
  <view class="modal" wx:if="{{showTransferModal}}">
    <view class="modal-content">
      <input class="transfer-input" placeholder="è¾“å…¥è½¬è´¦é‡‘é¢(1-10000)" type="number" bindinput="onTransferAmountInput" />
      <button class="confirm-btn" bindtap="confirmTransfer">
        <text class="btn-icon">ğŸ’°</text>
        <text class="btn-text">ç¡®å®šè½¬è´¦</text>
      </button>
      <button class="close-btn" bindtap="hideTransferModal">
        <text class="btn-icon">âŒ</text>
        <text class="btn-text">å–æ¶ˆ</text>
      </button>
    </view>
  </view>

  <!-- ä¿®æ”¹èµ„æ–™å¼¹çª— -->
  <view class="modal" wx:if="{{showProfileModal}}">
    <view class="modal-content profile-modal">
      <view class="modal-title">ä¿®æ”¹ä¸ªäººèµ„æ–™</view>
      
      <!-- å¤´åƒé¢„è§ˆå’Œä¸Šä¼ åŒºåŸŸ -->
      <view class="avatar-upload-section">
        <view class="avatar-preview-container">
          <image class="avatar-preview" src="{{currentUserAvatar}}" mode="aspectFill" bindtap="chooseAvatar"></image>
        </view>
      </view>

      <!-- æ˜µç§°è¾“å…¥ -->
      <view class="input-section">
        <input class="profile-input" placeholder="è¯·è¾“å…¥æ‚¨çš„æ˜µç§°" value="{{newNickname}}" bindinput="onNicknameInput" maxlength="20" />
      </view>

      <view class="button-group">
        <button class="confirm-btn" bindtap="confirmUpdateProfile">
          <text class="btn-text">ä¿å­˜</text>
        </button>
        <button class="close-btn" bindtap="hideProfileModal">
          <text class="btn-text">å–æ¶ˆ</text>
        </button>
      </view>
    </view>
  </view>
</view>
